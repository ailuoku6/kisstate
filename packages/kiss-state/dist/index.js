import{jsx as n}from"react/jsx-runtime";import t,{forwardRef as r,useMemo as e,useState as o,useCallback as u,useRef as i,useEffect as c}from"react";var a=function(){return a=Object.assign||function(n){for(var t,r=1,e=arguments.length;r<e;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},a.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var f=new WeakMap,l=new WeakMap,p={curTrackObj:null},s=function(n){(l.get(n)||[]).forEach((function(n){return n()})),l.delete(n)},h=function(n,t){var r=p.curTrackObj;p.curTrackObj=t;var e=null,o=null;try{e=n()}catch(n){o=n,s(t)}finally{p.curTrackObj=r}if(o)throw o;return e},v=new(function(){function n(){Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"isRunning",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"supportMessageChannel",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.supportMessageChannel="undefined"!=typeof MessageChannel}return Object.defineProperty(n.prototype,"add",{enumerable:!1,configurable:!0,writable:!0,value:function(n,t){this.queue.push(n),this.run()}}),Object.defineProperty(n.prototype,"run",{enumerable:!1,configurable:!0,writable:!0,value:function(){var n;if(!this.isRunning){this.isRunning=!0;var t=this.queue.shift();t&&(null===(n=t.fn)||void 0===n||n.call(t)),this.isRunning=!1}}}),n}()),d=function(n){(f.get(n)||[]).forEach((function(n){return n()}))},y=function(n,t){var r=((null==n?void 0:n.keys())||[]).filter((function(r){var e;return null===(e=n.get(r))||void 0===e?void 0:e.has(t)}));r.filter((function(n){return n.fn})).forEach((function(n){return v.add(n)})),r.filter((function(n){return!n.fn})).forEach((function(n){return s(n)}))},b=function(n,t){var r=f.get(n)||[];r.push(t),f.set(n,r)};function g(n){var t=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var e=new(n.bind.apply(n,function(n,t,r){if(r||2===arguments.length)for(var e,o=0,u=t.length;o<u;o++)!e&&o in t||(e||(e=Array.prototype.slice.call(t,0,o)),e[o]=t[o]);return n.concat(e||Array.prototype.slice.call(t))}([void 0],t,!1))),o=new Map;e.__trackObjMap__=o;var u=new Proxy(e,{set:function(n,t,r){var e=Reflect.get(n,t),i=Reflect.set(n,t,r);return e!==r&&(d(u),y(o,t)),i},get:function(n,t,r){var e,u,i,c=p.curTrackObj;if(c){var a=o.get(c)||new Set;a.add(t),o.set(c,a),e=c,u=function(){o.delete(c)},(i=l.get(e)||[]).push(u),l.set(e,i)}return Reflect.get(n,t,r)}}),i=n.prototype.__watchFns__||[],c=u;return i.forEach((function(n){var t=[];b(u,(function(){setTimeout((function(){var r,e=n.deps.map((function(n){return c[n]})),o=e.some((function(n,r){return n!==t[r]}));t=e,o&&(null===(r=c[n.methodName])||void 0===r||r.call(c))}),0)}))})),d(u),u};return(t.prototype=Object.create(n.prototype)).constructor=t,Object.assign(t,n),t}function m(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t,r,e){if("function"!=typeof e.value)throw new Error("@WatchProps can only decorate methods");var o=t.__watchFns__||[];o.push({methodName:r,deps:n}),t.__watchFns__=o}}function w(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t,r,e){if("function"!=typeof e.get)throw new Error("@computed can only decorate methods");var o=e.get,u=!0,i=null,c=!0,a=[];e.get=function(){var t;return c&&(c=!1,b(t=this,(function(){var e=n.map((function(n){return t[n]})),c=e.some((function(n,t){return n!==a[t]}));a=e,c&&(u=!0,i=o.call(t),u=!1,d(t),y(t.__trackObjMap__,r))}))),u?(i=o.call(this),u=!1,i):i}}}var O=0,_=function(){return null};function j(f){var l,p=function(n){return Object.prototype.isPrototypeOf.call(t.Component,n)||Object.prototype.isPrototypeOf.call(t.PureComponent,n)}(f),s=(l=f).$$typeof&&"Symbol(react.forward_ref)"===l.$$typeof.toString(),v=f.displayName||f.name,d=s?f.render:_,y=p?f.prototype.render:_,b=function(t,r){var l,v,b,g=(l=o(0)[1],u((function(){l((function(n){return n+1}))}),[])),m=(b=i({fn:v=g,id:"react-track-".concat(O++)}),c((function(){return b.current.fn=v,function(){b.current.fn=null}}),[v]),b.current),w=e((function(){if(!p)return s?function(t,r){var e=f;return e.render=function(n,t){return h((function(){return d(n,t)}),m)},n(e,a({},t,{ref:r}))}:function(n){return h((function(){return f(n)}),m)};var t=f,r=(t||{}).prototype;return(void 0===r?{}:r).render=function(){return h(y.bind(this),m)},function(r){return n(t,a({},r))}}),[f,p,s,m]);return w(t,r)},g=p||!s?b:r(b);return v&&(g.displayName=v),g}export{g as ObservableClass,w as computed,j as observer,m as watchProps};
