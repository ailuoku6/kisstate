import{jsx as e}from"react/jsx-runtime";import n,{forwardRef as t,useMemo as r,useState as o,useCallback as u,useRef as a,useEffect as c}from"react";var i=function(){return i=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},i.apply(this,arguments)};function f(e,n,t){if(t||2===arguments.length)for(var r,o=0,u=n.length;o<u;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))}"function"==typeof SuppressedError&&SuppressedError;var l=new WeakMap,s=new WeakMap,p={curTrackObj:null},h=function(e){(s.get(e)||[]).forEach((function(e){return e()})),s.delete(e)},d=function(e,n){var t=p.curTrackObj;p.curTrackObj=n;var r=null,o=null;try{r=e()}catch(e){o=e,h(n)}finally{p.curTrackObj=t}if(o)throw o;return r},v=new(function(){function e(){var e=this;Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"hasNextConsumer",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"supportMessageChannel",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.supportMessageChannel="undefined"!=typeof MessageChannel,this.supportMessageChannel&&(this.channel=new MessageChannel,this.channel.port1.onmessage=function(){e.run()})}return Object.defineProperty(e.prototype,"add",{enumerable:!1,configurable:!0,writable:!0,value:function(e,n){void 0===n&&(n={});var t=n.immediate;this.queue.push(e),t?this.run():this.startTask()}}),Object.defineProperty(e.prototype,"startTask",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.hasNextConsumer||(this.hasNextConsumer=!0,this.supportMessageChannel&&this.channel?this.channel.port2.postMessage(null):setTimeout((function(){e.run()}),0))}}),Object.defineProperty(e.prototype,"run",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,n=new Set,t=this.queue;for(console.log("---------fgylog run",f([],t,!0),t.length),this.queue=[],this.hasNextConsumer=!1;t.length;){var r=t.shift();r&&!n.has(r)&&(null===(e=r.fn)||void 0===e||e.call(r),n.add(r))}}}),e}()),b=function(e){(l.get(e)||[]).forEach((function(e){return v.add(e)}))},g=function(e,n){var t=l.get(e)||[];t.push(n),l.set(e,t)},y=function(e,n){var t=((null==e?void 0:e.keys())||[]).filter((function(t){var r;return null===(r=e.get(t))||void 0===r?void 0:r.has(n)}));t.filter((function(e){return e.fn})).forEach((function(e){return v.add(e)})),t.filter((function(e){return!e.fn})).forEach((function(e){return h(e)}))};function m(e){var n=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var r=new(e.bind.apply(e,f([void 0],n,!1))),o=new Map;r.__trackObjMap__=o;var u=new Proxy(r,{set:function(e,n,t){var r=Reflect.get(e,n),a=Reflect.set(e,n,t);return r!==t&&(console.log("---------fgylog set",n),b(u),y(o,n)),a},get:function(e,n,t){var r,u,a,c=p.curTrackObj;if(c){var i=o.get(c)||new Set;i.add(n),o.set(c,i),r=c,u=function(){o.delete(c)},(a=s.get(r)||[]).push(u),s.set(r,a)}return Reflect.get(e,n,t)}}),a=e.prototype.__watchFns__||[],c=u;return a.forEach((function(e){var n=[],t="w-".concat(e.methodName);g(u,{fn:function(){v.add({fn:function(){var t,r=e.deps.map((function(e){return c[e]})),o=r.some((function(e,t){return e!==n[t]}));n=r,o&&(null===(t=c[e.methodName])||void 0===t||t.call(c))},id:"w-".concat(e.methodName)})},id:t})})),b(u),u};return(n.prototype=Object.create(e.prototype)).constructor=n,Object.assign(n,e),n}function w(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(n,t,r){if("function"!=typeof r.value)throw new Error("@WatchProps can only decorate methods");var o=n.__watchFns__||[];o.push({methodName:t,deps:e}),n.__watchFns__=o}}function O(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(n,t,r){if("function"!=typeof r.get)throw new Error("@computed can only decorate methods");var o=r.get,u=!0,a=null,c=!0,i=[];r.get=function(){var n,r;return c&&(c=!1,n=this,r="h-cp-".concat(t),g(n,{fn:function(){var r=e.map((function(e){return n[e]})),c=r.some((function(e,n){return e!==i[n]}));i=r,c&&(u=!0,a=o.call(n),u=!1,b(n),y(n.__trackObjMap__,t))},id:r})),u?(a=o.call(this),u=!1,a):a}}}var j=0,_=function(){return null};function P(f){var l,s=function(e){return Object.prototype.isPrototypeOf.call(n.Component,e)||Object.prototype.isPrototypeOf.call(n.PureComponent,e)}(f),p=(l=f).$$typeof&&"Symbol(react.forward_ref)"===l.$$typeof.toString(),h=f.displayName||f.name,v=p?f.render:_,b=s?f.prototype.render:_,g=function(n,t){var l,h,g,y=(l=o(0)[1],u((function(){l((function(e){return e+1}))}),[])),m=(g=a({fn:h=y,id:"R-".concat(j++)}),c((function(){return g.current.fn=h,function(){g.current.fn=null}}),[h]),g.current),w=r((function(){if(!s)return p?function(n,t){var r=f;return r.render=function(e,n){return d((function(){return v(e,n)}),m)},e(r,i({},n,{ref:t}))}:function(e){return d((function(){return f(e)}),m)};var n=f,t=(n||{}).prototype;return(void 0===t?{}:t).render=function(){return d(b.bind(this),m)},function(t){return e(n,i({},t))}}),[f,s,p,m]);return w(n,t)},y=s||!p?g:t(g);return h&&(y.displayName=h),y}export{m as ObservableClass,O as computed,P as observer,w as watchProps};
