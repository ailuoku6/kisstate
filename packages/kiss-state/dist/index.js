import{jsx as t}from"react/jsx-runtime";import r,{useMemo as n,useEffect as e,useState as o,useCallback as u}from"react";var c=function(){return c=Object.assign||function(t){for(var r,n=1,e=arguments.length;n<e;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t},c.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var a=new WeakMap,i=new WeakMap,f={curCallBack:null},l=function(t,r){var n=f.curCallBack;f.curCallBack=r;var e=t();return f.curCallBack=n,e},p=function(t){(a.get(t)||[]).forEach((function(t){return t()}))},v=function(t,r){var n=a.get(t)||[];n.push(r),a.set(t,n)};function s(t){var r=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var e=new(t.bind.apply(t,function(t,r,n){if(n||2===arguments.length)for(var e,o=0,u=r.length;o<u;o++)!e&&o in r||(e||(e=Array.prototype.slice.call(r,0,o)),e[o]=r[o]);return t.concat(e||Array.prototype.slice.call(r))}([void 0],r,!1))),o=new Map;e.__callbackMap__=o;var u=new Proxy(e,{set:function(t,r,n){var e=Reflect.get(t,r),c=Reflect.set(t,r,n);return e!==n&&(p(u),o.keys().filter((function(t){var n;return null===(n=o.get(t))||void 0===n?void 0:n.has(r)})).forEach((function(t){return null==t?void 0:t()}))),c},get:function(t,r,n){var e,u,c,a=f.curCallBack;if(a){var l=o.get(a)||new Set;l.add(r),o.set(a,l),e=a,u=function(){o.delete(a)},(c=i.get(e)||[]).push(u),i.set(e,c)}return Reflect.get(t,r,n)}}),c=t.prototype.__watchFns||[],a=u;return c.forEach((function(t){var r=[];v(u,(function(){setTimeout((function(){var n,e=t.deps.map((function(t){return a[t]})),o=e.some((function(t,n){return t!==r[n]}));r=e,o&&(null===(n=a[t.methodName])||void 0===n||n.call(a))}),0)}))})),p(u),u};return(r.prototype=Object.create(t.prototype)).constructor=r,Object.assign(r,t),r}function h(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return function(r,n,e){if("function"!=typeof e.value)throw new Error("@WatchProps 只能装饰方法");var o=r.__watchFns||[];o.push({methodName:n,deps:t}),r.__watchFns=o}}function d(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return function(r,n,e){if("function"!=typeof e.get)throw new Error("@computed 只能装饰方法");var o=e.get,u=!0,c=null,a=!0,i=[];e.get=function(){var r;return a&&(a=!1,v(r=this,(function(){var e=t.map((function(t){return r[t]})),a=e.some((function(t,r){return t!==i[r]}));if(i=e,a){u=!0,c=o.call(r),u=!1,p(r);var f=r.__callbackMap__;((null==f?void 0:f.keys())||[]).filter((function(t){var r;return null===(r=f.get(t))||void 0===r?void 0:r.has(n)})).forEach((function(t){return null==t?void 0:t()}))}}))),u?(c=o.call(this),u=!1,c):c}}}var y=function(a){return function(f){var p,v=(p=o(0)[1],u((function(){p((function(t){return t+1}))}),[])),s=Object.prototype.isPrototypeOf.call(r.Component,a)||Object.prototype.isPrototypeOf.call(r.PureComponent,a),h=n((function(){if(!s)return function(t){return l((function(){return a(t)}),v)};var r=a,n=r.prototype,e=n.render;return n.render=function(){return l(e.bind(this),v)},function(n){return t(r,c({},n))}}),[a,s,v]);e((function(){return function(){var t;t=v,(i.get(t)||[]).forEach((function(t){return t()})),i.delete(t)}}),[v]);var d=null,y=null;try{d=h(f)}catch(t){y=t}if(y)throw y;return d}};export{s as ObservableClass,d as computed,y as observer,h as watchProps};
