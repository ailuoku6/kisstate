import{jsx as e}from"react/jsx-runtime";import n,{forwardRef as t,useMemo as r,useState as o,useCallback as u,useRef as a,useEffect as i,useDebugValue as c}from"react";var f=function(){return f=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},f.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var l=new WeakMap,s=new WeakMap,p=[],h={curTrackObj:null},d=function(e){(s.get(e)||[]).forEach((function(e){return e()})),s.delete(e)},v=function(e,n){var t=h.curTrackObj;h.curTrackObj=n;var r=null,o=null;try{r=e()}catch(e){o=e,d(n)}finally{h.curTrackObj=t}if(o)throw o;return r},b=new(function(){function e(){var e=this;Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"hasNextConsumer",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"supportMessageChannel",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.supportMessageChannel="undefined"!=typeof MessageChannel,this.supportMessageChannel&&(this.channel=new MessageChannel,this.channel.port1.onmessage=function(){e.run()})}return Object.defineProperty(e.prototype,"add",{enumerable:!1,configurable:!0,writable:!0,value:function(e,n){void 0===n&&(n={});var t=n.immediate;this.queue.push(e),t?this.run():this.startTask()}}),Object.defineProperty(e.prototype,"startTask",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.hasNextConsumer||(this.hasNextConsumer=!0,this.supportMessageChannel&&this.channel?this.channel.port2.postMessage(null):setTimeout((function(){e.run()}),0))}}),Object.defineProperty(e.prototype,"run",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,n=new Set,t=this.queue;for(this.queue=[],this.hasNextConsumer=!1;t.length;){var r=t.shift();r&&!n.has(r)&&(null===(e=r.fn)||void 0===e||e.call(r),n.add(r))}}}),e}()),g=function(e){(l.get(e)||[]).forEach((function(e){return b.add(e)}))},y=function(e,n){var t=l.get(e)||[];t.push(n),l.set(e,t)},m=function(e,n){var t=((null==e?void 0:e.keys())||[]).filter((function(t){var r;return null===(r=e.get(t))||void 0===r?void 0:r.has(n)}));t.filter((function(e){return e.fn})).forEach((function(e){return b.add(e)})),t.filter((function(e){return!e.fn})).forEach((function(e){return d(e)}))};function _(e){var n=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var r=new(e.bind.apply(e,function(e,n,t){if(t||2===arguments.length)for(var r,o=0,u=n.length;o<u;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))}([void 0],n,!1))),o=new Map;r.__trackObjMap__=o;var u=new Proxy(r,{set:function(e,n,t){var r=Reflect.get(e,n),a=Reflect.set(e,n,t);return r!==t&&(g(u),m(o,n)),a},get:function(e,n,t){var r,u,a,i=h.curTrackObj;if(i){var c=o.get(i)||new Set;c.add(n),o.set(i,c),r=i,u=function(){o.delete(i)},(a=s.get(r)||[]).push(u),s.set(r,a)}return Reflect.get(e,n,t)}}),a=e.prototype.__watchFns__||[];e.prototype.__getDebugValue__=function(e){var n=this.__trackObjMap__.get(e);return(null==n?void 0:n.size)?this:void 0};var i=u;return a.forEach((function(e){var n=[],t="w-".concat(e.methodName);y(u,{fn:function(){b.add({fn:function(){var t,r=e.deps.map((function(e){return i[e]})),o=r.some((function(e,t){return e!==n[t]}));n=r,o&&(null===(t=i[e.methodName])||void 0===t||t.call(i))},id:"w-".concat(e.methodName)})},id:t})})),g(u),p.push(r),u};return(n.prototype=Object.create(e.prototype)).constructor=n,Object.assign(n,e),n}function w(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(n,t,r){if("function"!=typeof r.value)throw new Error("@WatchProps can only decorate methods");var o=n.__watchFns__||[];o.push({methodName:t,deps:e}),n.__watchFns__=o}}function O(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(n,t,r){if("function"!=typeof r.get)throw new Error("@computed can only decorate methods");var o=r.get,u=!0,a=null,i=!0,c=[];r.get=function(){var n,r;return i&&(i=!1,n=this,r="c-".concat(t),y(n,{fn:function(){var r=e.map((function(e){return n[e]})),i=r.some((function(e,n){return e!==c[n]}));c=r,i&&(u=!0,a=o.call(n),u=!1,g(n),m(n.__trackObjMap__,t))},id:r})),u?(a=o.call(this),u=!1,a):a}}}var j=0,k=function(e){c(e,(function(e){return function(e){var n={},t=0;return p.forEach((function(r){var o,u=r.__getDebugValue__(e);u&&Object.assign(n,((o={})[t++]=u,o))})),console.info("debugvalue",n),n}(e)}))},M=function(){return null};function P(c){var l,s=function(e){return Object.prototype.isPrototypeOf.call(n.Component,e)||Object.prototype.isPrototypeOf.call(n.PureComponent,e)}(c),p=(l=c).$$typeof&&"Symbol(react.forward_ref)"===l.$$typeof.toString(),h=c.displayName||c.name,d=p?c.render:M,b=s?c.prototype.render:M,g=function(n,t){var l,h,g,y=(l=o(0)[1],u((function(){l((function(e){return e+1}))}),[])),m=(g=a({fn:h=y,id:"R-".concat(j++)}),i((function(){return g.current.fn=h,function(){g.current.fn=null}}),[h]),k(g.current),g.current),_=r((function(){if(!s)return p?function(n,t){var r=c;return r.render=function(e,n){return v((function(){return d(e,n)}),m)},e(r,f({},n,{ref:t}))}:function(e){return v((function(){return c(e)}),m)};var n=c,t=(n||{}).prototype;return(void 0===t?{}:t).render=function(){return v(b.bind(this),m)},function(t){return e(n,f({},t))}}),[c,s,p,m]);return _(n,t)},y=s||!p?g:t(g);return h&&(y.displayName=h),y}export{_ as ObservableClass,O as computed,P as observer,w as watchProps};
