import{jsx as r}from"react/jsx-runtime";import t,{useMemo as n,useEffect as e,useState as o,useCallback as c}from"react";var u=new WeakMap,a={curCallBack:null},l=function(r,t){var n=a.curCallBack;a.curCallBack=t;var e=r();return a.curCallBack=n,e},f=function(){return f=Object.assign||function(r){for(var t,n=1,e=arguments.length;n<e;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o]);return r},f.apply(this,arguments)};function i(r){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=new(r.bind.apply(r,function(r,t,n){if(n||2===arguments.length)for(var e,o=0,c=t.length;o<c;o++)!e&&o in t||(e||(e=Array.prototype.slice.call(t,0,o)),e[o]=t[o]);return r.concat(e||Array.prototype.slice.call(t))}([void 0],t,!1))),o=new Map,c=new Proxy(e,{set:function(r,t,n){console.log("--------fgylog set!!",r,t);var e=Reflect.set(r,t,n);return(u.get(c)||[]).forEach((function(r){return r()})),o.keys().filter((function(r){var n;return null===(n=o.get(r))||void 0===n?void 0:n.has(t)})).forEach((function(r){return null==r?void 0:r()})),e},get:function(r,t,n){var e=a.curCallBack;if(console.log("--------fgylog get!!",r,t,n),e){var c=o.get(e)||new Set;c.add(t),o.set(e,c),console.log("--------linsenSet",Array.from(c))}return Reflect.get(r,t,n)}}),l=r.prototype.__watchFns||[],f=c;return l.forEach((function(r){var t=[],n=u.get(c)||[];n.push((function(){var n,e=r.deps.map((function(r){return f[r]})),o=e.some((function(r,n){return r!==t[n]}));t=e,o&&(null===(n=f[r.methodName])||void 0===n||n.call(f))})),u.set(c,n)})),(u.get(c)||[]).forEach((function(r){return r()})),c};return(t.prototype=Object.create(r.prototype)).constructor=t,Object.assign(t,r),t}function p(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return function(t,n,e){if("function"!=typeof e.value)throw new Error("@WatchProps 只能装饰方法");var o=t.__watchFns||[];o.push({methodName:n,deps:r}),t.__watchFns=o}}function s(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return function(t,n,e){if("function"!=typeof e.get)throw new Error("@computed 只能装饰方法");var o=e.get,c=!0,a=null,l=!0,f=[];e.get=function(){var t,n;return l&&(l=!1,t=this,(n=u.get(t)||[]).push((function(){var n=r.map((function(r){return t[r]})),e=n.some((function(r,t){return r!==f[t]}));f=n,e&&(c=!0)})),u.set(t,n)),c?(a=o.call(this),c=!1,a):a}}}"function"==typeof SuppressedError&&SuppressedError;var g=function(u){return function(a){var i,p=(i=o(0)[1],c((function(){i((function(r){return r+1}))}),[])),s=Object.prototype.isPrototypeOf.call(t.Component,u)||Object.prototype.isPrototypeOf.call(t.PureComponent,u),g=n((function(){if(!s)return function(r){return l((function(){return u(r)}),p)};var t=u,n=t.prototype,e=n.render;return n.render=function(){return l(e.bind(this),p)},function(n){return r(t,f({},n))}}),[u,s,p]);e((function(){console.log("------------fgylog renderend!!")}),[]);var v=null,h=null;console.log("------------fgylog renderstart!");try{v=g(a)}catch(r){h=r}finally{console.log("------------fgylog renderend!")}if(h)throw h;return v}};export{i as ObservableClass,s as computed,a as globalStore,g as observer,u as renderEffctWeakMap,l as trackFun,p as watchProps};
