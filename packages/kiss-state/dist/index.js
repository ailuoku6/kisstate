import{jsx as e}from"react/jsx-runtime";import n,{forwardRef as t,useMemo as r,useState as o,useCallback as u,useRef as a,useEffect as i}from"react";var c=function(){return c=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},c.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var f=new WeakMap,l=new WeakMap,s={curTrackObj:null},p=function(e){(l.get(e)||[]).forEach((function(e){return e()})),l.delete(e)},h=function(e,n){var t=s.curTrackObj;s.curTrackObj=n;var r=null,o=null;try{r=e()}catch(e){o=e,p(n)}finally{s.curTrackObj=t}if(o)throw o;return r},d=new(function(){function e(){var e=this;Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"hasNextConsumer",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"supportMessageChannel",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.supportMessageChannel="undefined"!=typeof MessageChannel,this.supportMessageChannel&&(this.channel=new MessageChannel,this.channel.port1.onmessage=function(){e.run()})}return Object.defineProperty(e.prototype,"add",{enumerable:!1,configurable:!0,writable:!0,value:function(e,n){void 0===n&&(n={});var t=n.immediate;this.queue.push(e),t?this.run():this.startTask()}}),Object.defineProperty(e.prototype,"startTask",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.hasNextConsumer||(this.hasNextConsumer=!0,this.supportMessageChannel&&this.channel?this.channel.port2.postMessage(null):setTimeout((function(){e.run()}),0))}}),Object.defineProperty(e.prototype,"run",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,n=new Set,t=this.queue;for(this.queue=[],this.hasNextConsumer=!1;t.length;){var r=t.shift();r&&!n.has(r)&&(null===(e=r.fn)||void 0===e||e.call(r),n.add(r))}}}),e}()),v=function(e){(f.get(e)||[]).forEach((function(e){return d.add({fn:e})}))},b=function(e,n){var t=((null==e?void 0:e.keys())||[]).filter((function(t){var r;return null===(r=e.get(t))||void 0===r?void 0:r.has(n)}));t.filter((function(e){return e.fn})).forEach((function(e){return d.add(e)})),t.filter((function(e){return!e.fn})).forEach((function(e){return p(e)}))},y=function(e,n){var t=f.get(e)||[];t.push(n),f.set(e,t)};function g(e){var n=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var r=new(e.bind.apply(e,function(e,n,t){if(t||2===arguments.length)for(var r,o=0,u=n.length;o<u;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))}([void 0],n,!1))),o=new Map;r.__trackObjMap__=o;var u=new Proxy(r,{set:function(e,n,t){var r=Reflect.get(e,n),a=Reflect.set(e,n,t);return r!==t&&(v(u),b(o,n)),a},get:function(e,n,t){var r,u,a,i=s.curTrackObj;if(i){var c=o.get(i)||new Set;c.add(n),o.set(i,c),r=i,u=function(){o.delete(i)},(a=l.get(r)||[]).push(u),l.set(r,a)}return Reflect.get(e,n,t)}}),a=e.prototype.__watchFns__||[],i=u;return a.forEach((function(e){var n=[];y(u,(function(){d.add({fn:function(){var t,r=e.deps.map((function(e){return i[e]})),o=r.some((function(e,t){return e!==n[t]}));n=r,o&&(null===(t=i[e.methodName])||void 0===t||t.call(i))}})}))})),v(u),u};return(n.prototype=Object.create(e.prototype)).constructor=n,Object.assign(n,e),n}function m(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(n,t,r){if("function"!=typeof r.value)throw new Error("@WatchProps can only decorate methods");var o=n.__watchFns__||[];o.push({methodName:t,deps:e}),n.__watchFns__=o}}function w(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(n,t,r){if("function"!=typeof r.get)throw new Error("@computed can only decorate methods");var o=r.get,u=!0,a=null,i=!0,c=[];r.get=function(){var n;return i&&(i=!1,y(n=this,(function(){var r=e.map((function(e){return n[e]})),i=r.some((function(e,n){return e!==c[n]}));c=r,i&&(u=!0,a=o.call(n),u=!1,v(n),b(n.__trackObjMap__,t))}))),u?(a=o.call(this),u=!1,a):a}}}var O=0,j=function(){return null};function _(f){var l,s=function(e){return Object.prototype.isPrototypeOf.call(n.Component,e)||Object.prototype.isPrototypeOf.call(n.PureComponent,e)}(f),p=(l=f).$$typeof&&"Symbol(react.forward_ref)"===l.$$typeof.toString(),d=f.displayName||f.name,v=p?f.render:j,b=s?f.prototype.render:j,y=function(n,t){var l,d,y,g=(l=o(0)[1],u((function(){l((function(e){return e+1}))}),[])),m=(y=a({fn:d=g,id:"R-".concat(O++)}),i((function(){return y.current.fn=d,function(){y.current.fn=null}}),[d]),y.current),w=r((function(){if(!s)return p?function(n,t){var r=f;return r.render=function(e,n){return h((function(){return v(e,n)}),m)},e(r,c({},n,{ref:t}))}:function(e){return h((function(){return f(e)}),m)};var n=f,t=(n||{}).prototype;return(void 0===t?{}:t).render=function(){return h(b.bind(this),m)},function(t){return e(n,c({},t))}}),[f,s,p,m]);return w(n,t)},g=s||!p?y:t(y);return d&&(g.displayName=d),g}export{g as ObservableClass,w as computed,_ as observer,m as watchProps};
