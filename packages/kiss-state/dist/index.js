import{jsx as n}from"react/jsx-runtime";import t,{forwardRef as e,useMemo as r,useState as o,useCallback as u,useRef as i,useEffect as a}from"react";var c=function(){return c=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},c.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var f=new WeakMap,l=new WeakMap,p={curTrackObj:null},s=function(n){(l.get(n)||[]).forEach((function(n){return n()})),l.delete(n)},h=function(n,t){var e=p.curTrackObj;p.curTrackObj=t;var r=null,o=null;try{r=n()}catch(n){o=n,s(t)}finally{p.curTrackObj=e}if(o)throw o;return r},v=new(function(){function n(){Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"isRunning",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"supportMessageChannel",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.supportMessageChannel="undefined"!=typeof MessageChannel}return Object.defineProperty(n.prototype,"add",{enumerable:!1,configurable:!0,writable:!0,value:function(n,t){void 0===t&&(t={});var e=t.immediate;this.queue.push(n),e?this.run():this.startTask()}}),Object.defineProperty(n.prototype,"startTask",{enumerable:!1,configurable:!0,writable:!0,value:function(){var n=this;this.isRunning||(this.isRunning=!0,setTimeout((function(){n.run(),n.isRunning=!1}),0))}}),Object.defineProperty(n.prototype,"run",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var n;this.queue.length;){var t=this.queue.shift();t&&(null===(n=t.fn)||void 0===n||n.call(t))}}}),n}()),d=function(n){(f.get(n)||[]).forEach((function(n){return v.add({fn:n})}))},y=function(n,t){var e=((null==n?void 0:n.keys())||[]).filter((function(e){var r;return null===(r=n.get(e))||void 0===r?void 0:r.has(t)}));e.filter((function(n){return n.fn})).forEach((function(n){return v.add(n)})),e.filter((function(n){return!n.fn})).forEach((function(n){return s(n)}))},b=function(n,t){var e=f.get(n)||[];e.push(t),f.set(n,e)};function g(n){var t=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=new(n.bind.apply(n,function(n,t,e){if(e||2===arguments.length)for(var r,o=0,u=t.length;o<u;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return n.concat(r||Array.prototype.slice.call(t))}([void 0],t,!1))),o=new Map;r.__trackObjMap__=o;var u=new Proxy(r,{set:function(n,t,e){var r=Reflect.get(n,t),i=Reflect.set(n,t,e);return r!==e&&(d(u),y(o,t)),i},get:function(n,t,e){var r,u,i,a=p.curTrackObj;if(a){var c=o.get(a)||new Set;c.add(t),o.set(a,c),r=a,u=function(){o.delete(a)},(i=l.get(r)||[]).push(u),l.set(r,i)}return Reflect.get(n,t,e)}}),i=n.prototype.__watchFns__||[],a=u;return i.forEach((function(n){var t=[];b(u,(function(){setTimeout((function(){var e,r=n.deps.map((function(n){return a[n]})),o=r.some((function(n,e){return n!==t[e]}));t=r,o&&(null===(e=a[n.methodName])||void 0===e||e.call(a))}),0)}))})),d(u),u};return(t.prototype=Object.create(n.prototype)).constructor=t,Object.assign(t,n),t}function m(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t,e,r){if("function"!=typeof r.value)throw new Error("@WatchProps can only decorate methods");var o=t.__watchFns__||[];o.push({methodName:e,deps:n}),t.__watchFns__=o}}function w(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t,e,r){if("function"!=typeof r.get)throw new Error("@computed can only decorate methods");var o=r.get,u=!0,i=null,a=!0,c=[];r.get=function(){var t;return a&&(a=!1,b(t=this,(function(){var r=n.map((function(n){return t[n]})),a=r.some((function(n,t){return n!==c[t]}));c=r,a&&(u=!0,i=o.call(t),u=!1,d(t),y(t.__trackObjMap__,e))}))),u?(i=o.call(this),u=!1,i):i}}}var O=0,_=function(){return null};function j(f){var l,p=function(n){return Object.prototype.isPrototypeOf.call(t.Component,n)||Object.prototype.isPrototypeOf.call(t.PureComponent,n)}(f),s=(l=f).$$typeof&&"Symbol(react.forward_ref)"===l.$$typeof.toString(),v=f.displayName||f.name,d=s?f.render:_,y=p?f.prototype.render:_,b=function(t,e){var l,v,b,g=(l=o(0)[1],u((function(){l((function(n){return n+1}))}),[])),m=(b=i({fn:v=g,id:"react-track-".concat(O++)}),a((function(){return b.current.fn=v,function(){b.current.fn=null}}),[v]),b.current),w=r((function(){if(!p)return s?function(t,e){var r=f;return r.render=function(n,t){return h((function(){return d(n,t)}),m)},n(r,c({},t,{ref:e}))}:function(n){return h((function(){return f(n)}),m)};var t=f,e=(t||{}).prototype;return(void 0===e?{}:e).render=function(){return h(y.bind(this),m)},function(e){return n(t,c({},e))}}),[f,p,s,m]);return w(t,e)},g=p||!s?b:e(b);return v&&(g.displayName=v),g}export{g as ObservableClass,w as computed,j as observer,m as watchProps};
