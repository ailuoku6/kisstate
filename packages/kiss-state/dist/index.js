import{jsx as t}from"react/jsx-runtime";import r,{useMemo as n,useEffect as e,useState as o,useCallback as u}from"react";var c=function(){return c=Object.assign||function(t){for(var r,n=1,e=arguments.length;n<e;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t},c.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var a=new WeakMap,f=new WeakMap,i={curCallBack:null},l=function(t,r){var n=i.curCallBack;i.curCallBack=r;var e=t();return i.curCallBack=n,e};function p(t){var r=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var e=new(t.bind.apply(t,function(t,r,n){if(n||2===arguments.length)for(var e,o=0,u=r.length;o<u;o++)!e&&o in r||(e||(e=Array.prototype.slice.call(r,0,o)),e[o]=r[o]);return t.concat(e||Array.prototype.slice.call(r))}([void 0],r,!1))),o=new Map,u=new Proxy(e,{set:function(t,r,n){var e=Reflect.get(t,r),c=Reflect.set(t,r,n);e!==n&&((a.get(u)||[]).forEach((function(t){return t()})),o.keys().filter((function(t){var n;return null===(n=o.get(t))||void 0===n?void 0:n.has(r)})).forEach((function(t){return null==t?void 0:t()})));return c},get:function(t,r,n){var e,u,c,a=i.curCallBack;if(a){var l=o.get(a)||new Set;l.add(r),o.set(a,l),e=a,u=function(){o.delete(a)},(c=f.get(e)||[]).push(u),f.set(e,c)}return Reflect.get(t,r,n)}}),c=t.prototype.__watchFns||[],l=u;return c.forEach((function(t){var r=[],n=a.get(u)||[];n.push((function(){var n,e=t.deps.map((function(t){return l[t]})),o=e.some((function(t,n){return t!==r[n]}));r=e,o&&(null===(n=l[t.methodName])||void 0===n||n.call(l))})),a.set(u,n)})),(a.get(u)||[]).forEach((function(t){return t()})),u};return(r.prototype=Object.create(t.prototype)).constructor=r,Object.assign(r,t),r}function s(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return function(r,n,e){if("function"!=typeof e.value)throw new Error("@WatchProps 只能装饰方法");var o=r.__watchFns||[];o.push({methodName:n,deps:t}),r.__watchFns=o}}function v(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return function(r,n,e){if("function"!=typeof e.get)throw new Error("@computed 只能装饰方法");var o=e.get,u=!0,c=null,f=!0,i=[];e.get=function(){var r,n;return f&&(f=!1,r=this,(n=a.get(r)||[]).push((function(){var n=t.map((function(t){return r[t]})),e=n.some((function(t,r){return t!==i[r]}));i=n,e&&(u=!0,c=o.call(r),u=!1,(a.get(r)||[]).forEach((function(t){return t()})))})),a.set(r,n)),u?(c=o.call(this),u=!1,c):c}}}var h=function(a){return function(i){var p,s=(p=o(0)[1],u((function(){p((function(t){return t+1}))}),[])),v=Object.prototype.isPrototypeOf.call(r.Component,a)||Object.prototype.isPrototypeOf.call(r.PureComponent,a),h=n((function(){if(!v)return function(t){return l((function(){return a(t)}),s)};var r=a,n=r.prototype,e=n.render;return n.render=function(){return l(e.bind(this),s)},function(n){return t(r,c({},n))}}),[a,v,s]);e((function(){return function(){var t;t=s,(f.get(t)||[]).forEach((function(t){return t()})),f.delete(t)}}),[s]);var g=null,y=null;try{g=h(i)}catch(t){y=t}if(y)throw y;return g}};export{p as ObservableClass,v as computed,h as observer,s as watchProps};
